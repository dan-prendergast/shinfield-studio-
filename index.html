<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Shinfield Studios — Visitor Map & Amenities</title>
  <meta name="description" content="Visitor-friendly map of key amenities around Shinfield Studios with driving distances and times." />
  
  <!-- Tailwind (CDN) for quick styling on GitHub Pages -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    html, body { height: 100%; }
    #map { height: 100%; min-height: 480px; }
    .gm-style .gm-style-iw-c { font-size: 0.95rem; }
  </style>
  
  <!-- Leaflet fallback assets will be injected dynamically only if Google Maps fails -->
</head>
<body class="bg-slate-50 text-slate-800">
  <!-- Header -->
  <header class="w-full border-b bg-white">
    <div class="max-w-7xl mx-auto px-4 py-6 flex flex-col gap-4 items-center text-center">
      <h1 class="text-4xl font-bold text-indigo-700">Shinfield Studios — Visitor Map & Amenities</h1>
      <p class="text-base text-slate-600">Key amenities with approximate driving distance (mi) & time (min) from the studio.</p>
      <div class="w-full">
        <!-- Studio site map image stretched across header with clickable enlarge link -->
        <a href="https://tse2.mm.bing.net/th/id/OIP.TY5wE_SClbkj3SByDZLOogHaGi" target="_blank" rel="noopener noreferrer">
          <img src="https://tse2.mm.bing.net/th/id/OIP.TY5wE_SClbkj3SByDZLOogHaGi" alt="Shinfield Studios Site Map" class="w-full max-h-64 object-contain rounded shadow hover:opacity-90" />
        </a>
        <p class="text-xs text-slate-500 mt-1">Click the map to view full size in a new tab.</p>
      </div>
      <div class="text-xs text-slate-500">
        <span>Last updated: Sep 2025</span>
      </div>
    </div>
  </header>

  <!-- Layout -->
  <main class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-4 p-4">
    <!-- Map (Google Maps) -->
    <section class="lg:col-span-2 h-[70vh] lg:h-[78vh] rounded-2xl overflow-hidden shadow relative">
      <a href="https://www.google.com/maps/dir/?api=1&origin=Shinfield+Studios,+South+Avenue,+Reading&destination=Shinfield+Studios,+South+Avenue,+Reading" target="_blank" rel="noopener noreferrer" class="absolute inset-0 z-10" title="Open in Google Maps"></a>
      <div id="map"></div>
      <div id="mapError" class="hidden absolute bottom-2 left-2 right-2 mx-2 bg-amber-100 text-amber-900 text-xs rounded px-3 py-2 shadow">
        Having trouble loading Google Maps. Showing fallback map instead.
      </div>
      <noscript>
        <div class="p-4 text-sm text-red-700">This map requires JavaScript. Please enable it in your browser.</div>
      </noscript>
    </section>

    <!-- Sidebar: Suggested Amenities & POI list -->
    <aside class="lg:col-span-1 bg-white rounded-2xl shadow divide-y">
      <div class="p-4">
        <h2 class="text-lg font-semibold mb-2">Suggested Amenities</h2>
        <ol class="list-decimal list-inside space-y-1 text-sm">
          <li><strong>Immediate essentials (0–5 min)</strong>: Tesco Express; Esso Petrol; Shinfield Pharmacy.</li>
          <li><strong>Lower Earley cluster (~6 min)</strong>: McDonald’s; M&S Simply Food; Greggs (all at The Square / Chalfont Way).</li>
          <li><strong>Larger needs</strong>: Morrisons (full shop); Screwfix (tools & fixings).</li>
          <li><strong>Health & emergencies</strong>: Royal Berkshire Hospital; Pharmacy for minor needs.</li>
          <li><strong>Alternative fuel</strong>: ASDA Petrol (Chalfont Way, 24-h).</li>
        </ol>
      </div>
      <div class="p-4">
        <div class="flex items-center justify-between mb-2">
          <h3 class="text-lg font-semibold">All Amenities</h3>
          <label class="text-xs text-slate-600">Sort by
            <select id="sortSelect" class="ml-1 border rounded px-2 py-1 text-xs">
              <option value="distance">Distance (mi)</option>
              <option value="time">Drive time (min)</option>
              <option value="name">Name (A–Z)</option>
            </select>
          </label>
        </div>
        <ul id="poiList" class="space-y-2 text-sm"></ul>
      </div>
    </aside>
  </main>

  <footer class="max-w-7xl mx-auto px-4 pb-6 text-xs text-slate-500 text-center">
    <p>
      Map data © Google. Distances & times are approximate (typical traffic). You will need a Google Maps JavaScript API key.
    </p>
  </footer>

  <script>
    // --- Studio (map center) ---
    const studio = { name: "Shinfield Studios", lat: 51.415496, lng: -0.938695 };

    // --- Points of Interest ---
    const pois = [
      { name: "Tesco Express (203–207 Shinfield Rd)", category: "Supermarket", lat: 51.427981, lng: -0.945786, distanceMi: 0.2, driveMin: 2 },
      { name: "Esso Petrol (211 Shinfield Rd)", category: "Petrol", lat: 51.42787, lng: -0.94560, distanceMi: 0.3, driveMin: 2 },
      { name: "Shinfield Pharmacy (School Green)", category: "Pharmacy", lat: 51.40419, lng: -0.94874, distanceMi: 0.5, driveMin: 3 },
      { name: "McDonald’s (The Square, Lower Earley)", category: "Fast Food", lat: 51.423233, lng: -0.934716, distanceMi: 2.0, driveMin: 6 },
      { name: "M&S Simply Food (3 The Square, Lower Earley)", category: "Supermarket", lat: 51.423016, lng: -0.9349004, distanceMi: 2.0, driveMin: 6 },
      { name: "Greggs (Chalfont Way, Lower Earley)", category: "Bakery/Coffee", lat: 51.42457, lng: -0.93274, distanceMi: 2.1, driveMin: 6 },
      { name: "Morrisons (Basingstoke Rd)", category: "Supermarket", lat: 51.434118, lng: -0.970483, distanceMi: 1.0, driveMin: 4 },
      { name: "Screwfix (Tilehurst, Stadium Way)", category: "Hardware/DIY", lat: 51.463272, lng: -1.013296, distanceMi: 4.1, driveMin: 11 },
      { name: "Royal Berkshire Hospital (London Rd)", category: "Hospital", lat: 51.449038, lng: -0.958427, distanceMi: 1.0, driveMin: 4 },
      { name: "ASDA Petrol (Chalfont Way, Lower Earley)", category: "Petrol", lat: 51.423325, lng: -0.9324726, distanceMi: 1.5, driveMin: 5 }
    ];

    let map, infoWindow, markers = [];

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: studio.lat, lng: studio.lng },
        zoom: 14,
        mapTypeControl: false,
        streetViewControl: false,
        fullscreenControl: true
      });

      infoWindow = new google.maps.InfoWindow();

      // Studio marker
      const studioMarker = new google.maps.Marker({
        position: { lat: studio.lat, lng: studio.lng },
        map,
        title: studio.name,
        icon: {
          path: google.maps.SymbolPath.BACKWARD_CLOSED_ARROW,
          scale: 6,
          fillColor: '#4f46e5',
          fillOpacity: 1,
          strokeColor: '#312e81',
          strokeWeight: 1
        }
      });
      studioMarker.addListener('click', () => {
        infoWindow.setContent(`<strong>${studio.name}</strong><br>South Avenue, RG2 9LH`);
        infoWindow.open(map, studioMarker);
      });

      // POI markers
      const bounds = new google.maps.LatLngBounds();
      bounds.extend(studioMarker.getPosition());

      pois.forEach(p => {
        const marker = new google.maps.Marker({ position: { lat: p.lat, lng: p.lng }, map, title: p.name });
        marker.addListener('click', () => {
          infoWindow.setContent(`<strong>${p.name}</strong><br><em>${p.category}</em><br>${p.distanceMi.toFixed(1)} mi · ~${p.driveMin} min drive<br><a href='https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(studio.name + ", South Avenue, Reading")}&destination=${encodeURIComponent(p.name)}' target='_blank' rel='noopener noreferrer' class='text-indigo-600 underline'>Directions from Shinfield Studios</a>`);
          infoWindow.open(map, marker);
        });
        markers.push({ marker, data: p });
        bounds.extend(marker.getPosition());
      });

      map.fitBounds(bounds, 40);
      buildList('distance');

      document.getElementById('sortSelect').addEventListener('change', (e) => {
        buildList(e.target.value);
      });
    }

    function buildList(sortBy = 'distance') {
      const list = document.getElementById('poiList');
      const items = markers.map(m => m);

      if (sortBy === 'distance') items.sort((a,b) => a.data.distanceMi - b.data.distanceMi);
      if (sortBy === 'time') items.sort((a,b) => a.data.driveMin - b.data.driveMin);
      if (sortBy === 'name') items.sort((a,b) => a.data.name.localeCompare(b.data.name));

      list.innerHTML = '';
      items.forEach(({ marker, data }) => {
        const li = document.createElement('li');
        li.className = 'border rounded-xl p-3 hover:bg-slate-50 cursor-pointer';
        li.innerHTML = `
          <div class=\"text-sm font-medium\">${data.name}</div>
          <div class=\"text-xs text-slate-600\">${data.category} • ${data.distanceMi.toFixed(1)} mi • ~${data.driveMin} min</div>
          <a href='https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(studio.name + ", South Avenue, Reading")}&destination=${encodeURIComponent(data.name)}' target='_blank' rel='noopener noreferrer' class='text-indigo-600 underline text-xs'>Directions from Shinfield Studios</a>
        `;
        li.addEventListener('click', () => {
          map.panTo(marker.getPosition());
          map.setZoom(16);
          google.maps.event.trigger(marker, 'click');
          li.classList.add('ring', 'ring-indigo-400');
          setTimeout(() => li.classList.remove('ring', 'ring-indigo-400'), 1200);
        });
        list.appendChild(li);
      });
    }

    // Expose initMap for Google callback
    window.initMap = initMap;

    // --- Fallback: if Google Maps fails to load, automatically load Leaflet ---
    function initLeafletFallback() {
      const css = document.createElement('link');
      css.rel = 'stylesheet';
      css.href = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.css';
      document.head.appendChild(css);

      const js = document.createElement('script');
      js.src = 'https://unpkg.com/leaflet@1.9.4/dist/leaflet.js';
      js.onload = () => {
        const mapEl = document.getElementById('map');
        const warn = document.getElementById('mapError');
        if (warn) warn.classList.remove('hidden');
        const lmap = L.map(mapEl).setView([studio.lat, studio.lng], 14);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19, attribution: '&copy; OpenStreetMap contributors' }).addTo(lmap);
        const studioMarker = L.marker([studio.lat, studio.lng]).addTo(lmap).bindPopup(`<strong>${studio.name}</strong><br>South Avenue, RG2 9LH`);
        const group = [studioMarker];
        pois.forEach(p => {
          const m = L.marker([p.lat, p.lng]).addTo(lmap).bindPopup(`<strong>${p.name}</strong><br><em>${p.category}</em><br>${p.distanceMi.toFixed(1)} mi · ~${p.driveMin} min`);
          group.push(m);
        });
        const fg = L.featureGroup(group);
        lmap.fitBounds(fg.getBounds().pad(0.15));
      };
      document.body.appendChild(js);
    }

    // If the Google Maps script fails to load or no API key, trigger fallback after timeout
    setTimeout(() => {
      if (!window.google || !window.google.maps) {
        initLeafletFallback();
      }
    }, 3000);
  </script>

  <!-- Google Maps JavaScript API -->
  <!-- IMPORTANT: Replace YOUR_API_KEY with your actual key. Enable Maps JavaScript API in Google Cloud Console. -->
  <script id="gmaps" src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap" async defer onerror="initLeafletFallback()"></script>
</body>
</html>
